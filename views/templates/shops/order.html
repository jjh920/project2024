{% extends 'base.html' %}

{% block style %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/shop.css') }}">
<style>
</style>
{% endblock %}

{% block main %}
<main>
    <h2>주문/결제하기</h2>
    {% if m %}
    <form name="oderfrm">
        <!-- 더미 카트 데이터 row 1 -->
        <h3> 배송 정보 </h3>
        <div class="">이름 : {{ m.name }}</div>
        <div class="">전화번호 : {{ m.phone }}</div>
        <div class="">주소 : {{ m.zipcode }} {{ m.address1 }} {{ m.address2 }}</div>

        <h3> 주문 상품 </h3>
        {% set totals = [] %}
        {% for c in clist %}
        {% if totals.append(c.price * c.quantity) %}{% endif %}
        <div class="cart_pd_img" style="background-image: url('{{ c.tumbimg }}')"></div>
        <span class="cart_pd_title">{{ c.name }}</span>
        <div class="cart_pd_info_wrap">
            <div class="pd_exp">크기</div>
            <div class="pd_exp">가로 {{ c.width }}, 세로 {{ c.deps }}, 높이 {{ c.height }}</div>
            <div class="pd_exp">마감</div>
            <div class="pd_exp">천연 오크</div>
        </div>
        <div>가격</div>
        <div class="pd_price">{{ c.price }}</div>
        <div>수량</div>
        <div class="od_qty">:
            <input type="text" name="quantity" class="quantity" readonly value="{{ c.quantity }}">
        </div>
        <div>합계</div>
        <div class="pd_price">{{ c.price * c.quantity }}</div>


        <input type="hidden" name="pno" class="pno" readonly value="{{ c.pno }}">
        <input type="hidden" name="pdprice" class="pdprice" readonly value="{{ c.price * c.quantity }}">


        <hr>
        {% endfor %}


        <!-- footer -->
        <div class="footer">
            <div class="footer_inner">
                <div class="cart_notice">
                    <p>이 구매를 진행함으로써 귀하는 당사의
                        <a href="/visit/visit" title="Terms and Conditions">Terms and
                            개인 정보 보호 정책</a>
                        과
                        <a href="/visit/visit" title="Privacy">
                            약관
                        </a>
                        에 동의합니다.
                    </p>
                </div>
                <div class="subtotal_wrapper">
                    <div>총 가격</div>
                    <div class="total_price pd_price">
                        {{ totals | sum }} 원
                    </div>
                </div>
                <div class="cart_btns box">
                    <button type="button" class="btn" name="checkout" id="bbtn">
                        돌아가기
                    </button>
                    <button type="button" class="btn" name="checkout" id="ckbtn">
                        결제하기{{ totals | sum }}
                    </button>
                </div>


                <input type="hidden" name="mno" id="mno" value="{{ m.mno }}">
                <input type="hidden" name="unitprice" id="unitprice" class="unitprice" value="{{ totals | sum }}">

                <input type="hidden" name="pnos" id="pnos">
                <input type="hidden" name="quantitys" id="quantitys">
                <input type="hidden" name="pdprices" id="pdprices">


            </div>
        </div>
    </form>
    {% endif %}
</main>
{% endblock %}

{% block script %}
<script>

    // 주문 추가
    let ckbtn = document.querySelector('#ckbtn');
    let pnos = document.querySelector('#pnos');
    let quantitys = document.querySelector('#quantitys');
    let pdprices = document.querySelector('#pdprices');
    let oderfrm = document.oderfrm;


    ckbtn.addEventListener('click', () => {
        // 1회성
        mnoval = document.getElementsByName('mno');
        unitprice = document.getElementsByName('unitprice');

        // 반복
        pnoval = document.getElementsByName('pno');
        quanval = document.getElementsByName('quantity');
        priceval = document.getElementsByName('pdprice');


        for (i = 0; i < document.getElementsByName('pno').length; i++) {
            if (i === 0) {
                pnos.value = pnoval[i].value;
                quantitys.value = quanval[i].value;
                pdprices.value = priceval[i].value
                continue
            }
            pnos.value +=  ',' + pnoval[i].value;
            quantitys.value +=  ',' + quanval[i].value;
            pdprices.value +=  ',' + priceval[i].value;
        }
        console.log(pdprices.value);
        oderfrm.method = 'post';
        oderfrm.submit();
    });

    // 이전으로 돌아가기
    document.querySelector('#bbtn').addEventListener('click', () => {
        history.back();
    });

    // , 설정
    const reprices = document.querySelectorAll('.pd_price');
    for (const reprice of reprices) {
        reprice.innerHTML = reprice.innerHTML.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    }
</script>
{% endblock %}